const tourGuida={steps:[{id:"benvenuto",title:"Benvenuto all'esperienza immersiva di Canne al Vento!",content:"Questo tour ti guiderÃ  alla scoperta dei luoghi del celebre romanzo di Grazia Deledda attraverso immagini panoramiche interattive.",position:"center"},{id:"rotazione",title:"Esplora a 360Â°",content:"Trascina con il dito o con il mouse per ruotare la vista panoramica e guardare in tutte le direzioni. Prova a fare un giro completo per scoprire l'ambiente che ti circonda!",position:"bottom"},{id:"hotspot",title:"Cerca le aree speciali",content:"Mentre esplori, cerca le aree evidenziate di colore magenta che lampeggiano nell'immagine. Queste sono zone interattive che nascondono informazioni speciali.",position:"right"},{id:"interazione",title:"Interagisci con le aree evidenziate",content:"Quando passi il mouse sopra un'area interattiva, diventa verde. Cliccala per scoprire una targa con un indovinello legato al romanzo di Grazia Deledda.",position:"left"},{id:"indovinello",title:"Risolvi l'indovinello",content:"Ogni targa contiene una citazione del libro con alcune parole mancanti. Completa le frasi inserendo le parole corrette per procedere nella caccia al tesoro.",position:"bottom"},{id:"mappa",title:"Cerca sulla mappa",content:"Dopo aver esplorato la scena, clicca sul pulsante 'Cerca sulla mappa' per vedere la posizione esatta di questo luogo e come raggiungerlo.",position:"top"}],currentStep:0,active:false,tourElement:null,pointer:null,maskFound:false,modalOpened:false,areaHovered:false,initialized:false,init:function(){if(this.initialized)return;this.createTourElement();this.addStyles();this.initialized=true;console.log("Tour guida inizializzato")},createTourElement:function(){this.tourElement=document.createElement("div");this.tourElement.className="tour-popup";document.body.appendChild(this.tourElement);this.pointer=document.createElement("div");this.pointer.className="pointer-animation";document.body.appendChild(this.pointer)},addStyles:function(){const styleElement=document.createElement("style");styleElement.textContent=`
            .tour-popup {
                position: fixed;
                bottom: 20%;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(255, 255, 255, 0.95);
                border-radius: 8px;
                padding: 20px;
                max-width: 85%;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                z-index: 10000;
                text-align: center;
                animation: fadeIn 0.3s ease-in-out;
                display: none;
                color: #333;
            }

            .tour-popup h3 {
                margin-top: 0;
                color: var(--primary-color, #2c3e50);
                font-size: 1.3rem;
            }

            .tour-popup p {
                margin-bottom: 20px;
                line-height: 1.5;
                font-size: 1rem;
            }

            .tour-popup button {
                padding: 8px 16px;
                border: none;
                border-radius: 4px;
                margin: 0 5px;
                cursor: pointer;
                font-size: 0.9rem;
            }

            .tour-next {
                background-color: var(--primary-color, #2c3e50);
                color: white;
            }

            .tour-skip {
                background-color: transparent;
                color: var(--secondary-color, #3498db);
            }

            .highlight-area {
                position: fixed;
                pointer-events: none;
                border: 3px solid #ff00ff;
                border-radius: 50%;
                z-index: 9999;
                animation: pulse 1.5s infinite;
                opacity: 0.7;
            }

            .pointer-animation {
                position: fixed;
                top: 20% !important;
                width: 40px;
                height: 40px;
                pointer-events: none;
                z-index: 9999;
                transition: all 0.5s ease;
                display: none;
                font-size: 40px;
                text-align: center;
                line-height: 50px;
            }

            @keyframes pulse {
                0% {
                    box-shadow: 0 0 0 0 rgba(255, 0, 255, 0.7);
                }
                70% {
                    box-shadow: 0 0 0 15px rgba(255, 0, 255, 0);
                }
                100% {
                    box-shadow: 0 0 0 0 rgba(255, 0, 255, 0);
                }
            }

            @keyframes fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }

            .mock-hotspot {
                position: fixed;
                width: 80px;
                height: 80px;
                background-color: rgba(255, 0, 255, 0.5);
                border-radius: 50%;
                animation: pulse 1.5s infinite;
                pointer-events: none;
                z-index: 999;
                display: none;
            }

            .highlight-button {
                animation: pulse 1.5s infinite !important;
            }
        `;document.head.appendChild(styleElement)},startTour:function(){if(!this.initialized){this.init()}this.active=true;this.currentStep=0;this.maskFound=false;this.modalOpened=false;this.areaHovered=false;this.showStep(this.currentStep);this.addEventListeners();console.log("Tour guida avviato")},addEventListeners:function(){const container=document.getElementById("locationImage");if(!container){console.log("Container locationImage non trovato");return}let mouseMovements=0;const mouseListener=e=>{if(this.active&&this.currentStep===1){if(e.buttons===1){mouseMovements+=Math.abs(e.movementX)+Math.abs(e.movementY);if(mouseMovements>300){setTimeout(()=>{if(this.currentStep===1){this.nextStep()}},1e3)}}}};container.addEventListener("mousemove",mouseListener);this._mouseListener=mouseListener;let touchStartX=0,touchStartY=0;const touchStartListener=e=>{touchStartX=e.touches[0].clientX;touchStartY=e.touches[0].clientY};container.addEventListener("touchstart",touchStartListener);this._touchStartListener=touchStartListener;const touchMoveListener=e=>{if(this.active&&this.currentStep===1){const touchX=e.touches[0].clientX;const touchY=e.touches[0].clientY;const moveX=Math.abs(touchX-touchStartX);const moveY=Math.abs(touchY-touchStartY);mouseMovements+=moveX+moveY;if(mouseMovements>300){setTimeout(()=>{if(this.currentStep===1){this.nextStep()}},1e3)}touchStartX=touchX;touchStartY=touchY}};container.addEventListener("touchmove",touchMoveListener);this._touchMoveListener=touchMoveListener;const mouseoverListener=e=>{if(this.active&&this.currentStep===3&&!this.areaHovered){let targetElement=e.target;while(targetElement&&!(targetElement.classList&&(targetElement.classList.contains("hotspot")||targetElement.classList.contains("interactive-area")||targetElement.hasAttribute("data-interactive")))){const computedStyle=window.getComputedStyle(targetElement);const backgroundColor=computedStyle.backgroundColor;if(backgroundColor.includes("rgb(0, 128, 0)")||backgroundColor.includes("rgb(0, 255, 0)")||backgroundColor.includes("rgb(144, 238, 144)")||backgroundColor.includes("rgba(0, 128, 0")||backgroundColor.includes("rgba(0, 255, 0")||backgroundColor.includes("rgba(144, 238, 144")||backgroundColor.includes("#00ff00")||backgroundColor.includes("#00cc00")||backgroundColor.includes("#008000")||backgroundColor.includes("#90ee90")){this.areaHovered=true;setTimeout(()=>{if(this.currentStep===3){this.nextStep()}},1500);break}targetElement=targetElement.parentElement}}};document.addEventListener("mouseover",mouseoverListener);this._mouseoverListener=mouseoverListener;const clickListener=e=>{if(this.active&&this.currentStep===3){if(e.target.classList&&(e.target.classList.contains("hotspot")||e.target.classList.contains("interactive-area")||e.target.hasAttribute("data-interactive"))){this.areaClicked=true;setTimeout(()=>{if(this.currentStep===3&&this.areaClicked){this.nextStep()}},2e3)}}};container.addEventListener("click",clickListener);this._clickListener=clickListener;const documentClickListener=e=>{if(this.active&&this.currentStep===3){setTimeout(()=>{const modal=document.querySelector('.modal, .dialog, .popup, [role="dialog"]');if(modal&&window.getComputedStyle(modal).display!=="none"){if(!this.modalOpened){this.modalOpened=true;setTimeout(()=>{if(this.currentStep===3){this.nextStep()}},2e3)}}},300)}if(this.active&&this.currentStep===5){if(e.target.classList.contains("start-button")&&e.target.textContent.includes("Cerca sulla mappa")){setTimeout(()=>this.endTour(),1e3)}}};document.addEventListener("click",documentClickListener);this._documentClickListener=documentClickListener;const formSubmitListener=e=>{if(this.active&&this.currentStep===4){if(e.target&&e.target.tagName==="FORM"){e.preventDefault();setTimeout(()=>{if(this.currentStep===4){this.nextStep()}},1e3)}}};document.addEventListener("submit",formSubmitListener);this._formSubmitListener=formSubmitListener;const styleObserver=new MutationObserver(mutations=>{if(this.active&&this.currentStep===3&&!this.areaHovered){const possibleHotspots=document.querySelectorAll('.hotspot, .interactive-area, [data-interactive="true"], [class*="hotspot"], [class*="interactive"]');possibleHotspots.forEach(element=>{const computedStyle=window.getComputedStyle(element);const backgroundColor=computedStyle.backgroundColor;const borderColor=computedStyle.borderColor;if(backgroundColor.includes("rgb(0, 128, 0)")||backgroundColor.includes("rgb(0, 255, 0)")||backgroundColor.includes("rgb(144, 238, 144)")||backgroundColor.includes("rgba(0, 128, 0")||backgroundColor.includes("rgba(0, 255, 0")||backgroundColor.includes("rgba(144, 238, 144")||backgroundColor.includes("#00ff00")||backgroundColor.includes("#00cc00")||backgroundColor.includes("#008000")||backgroundColor.includes("#90ee90")||(borderColor.includes("rgb(0, 128, 0)")||borderColor.includes("rgb(0, 255, 0)")||borderColor.includes("rgb(144, 238, 144)")||borderColor.includes("#00ff00")||borderColor.includes("#00cc00")||borderColor.includes("#008000")||borderColor.includes("#90ee90"))){this.areaHovered=true;setTimeout(()=>{if(this.currentStep===3&&!this.modalOpened){this.nextStep()}},1500)}})}});const observer=new MutationObserver(mutations=>{mutations.forEach(mutation=>{if(mutation.type==="childList"&&this.active){const canvas=container.querySelector("canvas");if(canvas){if(this.currentStep===2&&!this.maskFound){const hotspots=document.querySelectorAll('.hotspot, .interactive-area, [data-interactive="true"]');if(hotspots&&hotspots.length>0){this.maskFound=true;this.createMockHotspot();setTimeout(()=>{if(this.currentStep===2){this.nextStep()}},3e3)}}}if(this.currentStep===3&&!this.modalOpened){const modal=document.querySelector('.modal, .dialog, .popup, [role="dialog"]');if(modal&&window.getComputedStyle(modal).display!=="none"){this.modalOpened=true;setTimeout(()=>{if(this.currentStep===3){this.nextStep()}},2e3)}}}if(mutation.type==="attributes"&&this.active&&this.currentStep===3&&!this.areaHovered){const target=mutation.target;if(target.classList&&(target.classList.contains("hotspot")||target.classList.contains("interactive-area")||target.hasAttribute("data-interactive"))){const style=window.getComputedStyle(target);const backgroundColor=style.backgroundColor;if(backgroundColor.includes("rgb(0, 128, 0)")||backgroundColor.includes("rgb(0, 255, 0)")||backgroundColor.includes("rgb(144, 238, 144)")||backgroundColor.includes("rgba(0, 128, 0")||backgroundColor.includes("rgba(0, 255, 0")||backgroundColor.includes("rgba(144, 238, 144")||backgroundColor.includes("#00ff00")||backgroundColor.includes("#00cc00")||backgroundColor.includes("#008000")||backgroundColor.includes("#90ee90")){this.areaHovered=true;setTimeout(()=>{if(this.currentStep===3&&!this.modalOpened){this.nextStep()}},1500)}}}})});if(container){observer.observe(container,{childList:true,subtree:true,attributes:true,attributeFilter:["style","class"]});styleObserver.observe(container,{attributes:true,subtree:true,attributeFilter:["style","class"]})}observer.observe(document.body,{childList:true,subtree:true,attributes:true,attributeFilter:["style","class"]});styleObserver.observe(document.body,{attributes:true,subtree:true,attributeFilter:["style","class"]});this._observer=observer;this._styleObserver=styleObserver},createMockHotspot:function(){if(this.mockHotspot)return;const container=document.getElementById("locationImage");if(!container)return;const existingHotspot=document.querySelector('.hotspot, .interactive-area, [data-interactive="true"]');const mockHotspot=document.createElement("div");mockHotspot.className="mock-hotspot";document.body.appendChild(mockHotspot);const rect=container.getBoundingClientRect();if(existingHotspot){const hotspotRect=existingHotspot.getBoundingClientRect();mockHotspot.style.left=hotspotRect.left+"px";mockHotspot.style.top=hotspotRect.top+"px"}else{mockHotspot.style.left=rect.left+rect.width*.5-40+"px";mockHotspot.style.top=rect.top+rect.height*.5-40+"px"}mockHotspot.style.display="block";this.pointer.style.display="block";this.pointer.innerHTML="ðŸ‘†";this.pointer.style.backgroundImage="none";this.pointer.style.fontSize="40px";this.pointer.style.textAlign="center";this.pointer.style.lineHeight="50px";this.pointer.style.width="50px";this.pointer.style.height="50px";this.pointer.style.left=parseFloat(mockHotspot.style.left)-60+"px";this.pointer.style.top=parseFloat(mockHotspot.style.top)-20+"px";this.mockHotspot=mockHotspot},showStep:function(index){const step=this.steps[index];this.tourElement.innerHTML=`
            <h3>${step.title}</h3>
            <p>${step.content}</p>
            <button class="tour-next">Continua</button>
            <button class="tour-skip">Salta tour</button>
        `;this.tourElement.style.display="block";switch(step.position){case"top":this.tourElement.style.bottom="auto";this.tourElement.style.top="20%";break;case"bottom":this.tourElement.style.top="auto";this.tourElement.style.bottom="20%";break;case"center":this.tourElement.style.top="50%";this.tourElement.style.bottom="auto";this.tourElement.style.transform="translate(-50%, -50%)";break;default:this.tourElement.style.top="auto";this.tourElement.style.bottom="20%";this.tourElement.style.transform="translateX(-50%)"}this.tourElement.querySelector(".tour-next").addEventListener("click",()=>this.nextStep());this.tourElement.querySelector(".tour-skip").addEventListener("click",()=>this.endTour());switch(index){case 1:this.showDragAnimation();break;case 2:this.pointer.style.display="none";break;case 3:this.areaClicked=false;this.modalOpened=false;this.areaHovered=false;if(this.mockHotspot){this.pointer.style.display="block";const rect=this.mockHotspot.getBoundingClientRect();this.pointer.style.left=rect.left-20+"px";this.pointer.style.top=rect.top+20+"px";const hoverClickAnimation=()=>{this.pointer.style.left=rect.left+20+"px";this.pointer.style.top=rect.top+20+"px";setTimeout(()=>{if(!this.areaHovered){this.mockHotspot.style.backgroundColor="rgba(0, 255, 0, 0.5)"}setTimeout(()=>{this.pointer.style.transform="scale(0.8)";setTimeout(()=>{this.pointer.style.transform="scale(1)";setTimeout(()=>{this.pointer.style.left=rect.left-20+"px";this.pointer.style.top=rect.top+20+"px";if(!this.areaHovered){this.mockHotspot.style.backgroundColor="rgba(255, 0, 255, 0.5)"}if(this.active&&this.currentStep===3&&!this.areaHovered&&!this.areaClicked&&!this.modalOpened){setTimeout(hoverClickAnimation,1500)}},1e3)},200)},800)},800)};hoverClickAnimation()}break;case 4:this.pointer.style.display="none";if(this.mockHotspot){this.mockHotspot.style.display="none"}break;case 5:const mapButton=document.querySelector(".start-button");if(mapButton&&mapButton.textContent.includes("Cerca sulla mappa")){mapButton.classList.add("highlight-button");const rect=mapButton.getBoundingClientRect();this.pointer.style.display="block";this.pointer.innerHTML="ðŸ‘†";this.pointer.style.left=rect.left+rect.width/2-20+"px";this.pointer.style.top=rect.top-40+"px";const mapClickAnimation=()=>{this.pointer.style.left=rect.left+rect.width/2+"px";this.pointer.style.top=rect.top+rect.height/2+"px";setTimeout(()=>{this.pointer.style.transform="scale(0.8)";setTimeout(()=>{this.pointer.style.transform="scale(1)";setTimeout(()=>{this.pointer.style.left=rect.left+rect.width/2-20+"px";this.pointer.style.top=rect.top-40+"px";if(this.active&&this.currentStep===5){setTimeout(mapClickAnimation,2e3)}},1e3)},200)},500)};mapClickAnimation()}break}},showDragAnimation:function(){const container=document.getElementById("locationImage");if(!container)return;const rect=container.getBoundingClientRect();this.pointer.innerHTML="ðŸ‘†";this.pointer.style.backgroundImage="none";this.pointer.style.fontSize="40px";this.pointer.style.textAlign="center";this.pointer.style.lineHeight="50px";this.pointer.style.width="50px";this.pointer.style.height="50px";this.pointer.style.display="block";this.pointer.style.left=rect.left+rect.width*.3+"px";this.pointer.style.top=rect.top+rect.height*.5+"px";let usingDragEmoji=false;const animateDrag=()=>{if(!usingDragEmoji){this.pointer.innerHTML="âœŠ";this.pointer.style.transform="scale(0.9)";usingDragEmoji=true}setTimeout(()=>{this.pointer.style.left=rect.left+rect.width*.7+"px"},500);setTimeout(()=>{this.pointer.innerHTML="ðŸ‘†";this.pointer.style.transform="scale(1)";usingDragEmoji=false;setTimeout(()=>{this.pointer.style.transition="left 0.3s ease";this.pointer.style.left=rect.left+rect.width*.3+"px";setTimeout(()=>{this.pointer.style.transition="all 0.5s ease";if(this.active&&this.currentStep===1){animateDrag()}},500)},1e3)},1500)};animateDrag();this._dragAnimationTimeout=setTimeout(()=>{if(this.pointer.style.display!=="none"){this.pointer.style.transition="all 0.5s ease"}},15e3)},nextStep:function(){this.currentStep++;if(this.currentStep>=this.steps.length){this.endTour();return}this.showStep(this.currentStep)},cleanupAnimations:function(){if(this.pointer){this.pointer.style.display="none"}if(this.mockHotspot&&this.mockHotspot.parentNode){document.body.removeChild(this.mockHotspot);this.mockHotspot=null}document.querySelectorAll(".highlight-button").forEach(el=>{el.classList.remove("highlight-button")});if(this._dragAnimationTimeout){clearTimeout(this._dragAnimationTimeout)}},cleanupListeners:function(){const container=document.getElementById("locationImage");if(container){if(this._mouseListener)container.removeEventListener("mousemove",this._mouseListener);if(this._touchStartListener)container.removeEventListener("touchstart",this._touchStartListener);if(this._touchMoveListener)container.removeEventListener("touchmove",this._touchMoveListener);if(this._clickListener)container.removeEventListener("click",this._clickListener)}if(this._mouseoverListener){document.removeEventListener("mouseover",this._mouseoverListener)}if(this._documentClickListener){document.removeEventListener("click",this._documentClickListener)}if(this._formSubmitListener){document.removeEventListener("submit",this._formSubmitListener)}if(this._observer){this._observer.disconnect()}if(this._styleObserver){this._styleObserver.disconnect()}},endTour:function(){this.tourElement.style.display="none";this.active=false;this.cleanupAnimations();this.cleanupListeners();localStorage.setItem("tourCompletato","true");console.log("Tour guida terminato")}};document.addEventListener("DOMContentLoaded",function(){tourGuida.init();document.addEventListener("click",function(e){if(e.target&&e.target.id==="startButton"){console.log("Pulsante Start cliccato");const tourCompletato=localStorage.getItem("tourCompletato")==="true";if(!tourCompletato){const checkForPanorama=setInterval(function(){const locationScreen=document.getElementById("locationScreen");const isVisible=locationScreen&&window.getComputedStyle(locationScreen).display!=="none";if(isVisible){clearInterval(checkForPanorama);const checkForCanvas=setInterval(function(){const container=document.getElementById("locationImage");const hasCanvas=container&&container.querySelector("canvas");if(hasCanvas){clearInterval(checkForCanvas);setTimeout(()=>{tourGuida.startTour()},500)}},500)}},500)}}});document.addEventListener("click",function(e){if(e.target&&e.target.getAttribute("data-id")==="startButton"){console.log("Pulsante Start (con data-id) cliccato");const tourCompletato=localStorage.getItem("tourCompletato")==="true";if(!tourCompletato){const checkForPanorama=setInterval(function(){const locationScreen=document.getElementById("locationScreen");const isVisible=locationScreen&&window.getComputedStyle(locationScreen).display!=="none";if(isVisible){clearInterval(checkForPanorama);const checkForCanvas=setInterval(function(){const container=document.getElementById("locationImage");const hasCanvas=container&&container.querySelector("canvas");if(hasCanvas){clearInterval(checkForCanvas);setTimeout(()=>{tourGuida.startTour()},500)}},500)}},500)}}});document.addEventListener("click",function(e){if(e.target&&e.target.textContent&&e.target.textContent.includes("Inizia l'avventura")){console.log('Pulsante "Inizia l\'avventura" cliccato');const tourCompletato=localStorage.getItem("tourCompletato")==="true";if(!tourCompletato){const checkForPanorama=setInterval(function(){const locationScreen=document.getElementById("locationScreen");const isVisible=locationScreen&&window.getComputedStyle(locationScreen).display!=="none";if(isVisible){clearInterval(checkForPanorama);const checkForCanvas=setInterval(function(){const container=document.getElementById("locationImage");const hasCanvas=container&&container.querySelector("canvas");if(hasCanvas){clearInterval(checkForCanvas);setTimeout(()=>{tourGuida.startTour()},500)}},500)}},500)}}})});